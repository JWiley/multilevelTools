<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multilevel Models using lmer • multilevelTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multilevel Models using lmer">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multilevelTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lmer-vignette.html">Multilevel Models using lmer</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JWiley/multilevelTools">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Multilevel Models using lmer</h1>
                        <h4 class="author">Joshua F. Wiley</h4>
            
            <h4 class="date">2020-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JWiley/multilevelTools/blob/master/vignettes/lmer-vignette.Rmd"><code>vignettes/lmer-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>lmer-vignette.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to use the <code>multilevelTools</code> package for further diagnostics and testing of mixed effects (a.k.a., multilevel) models using <code>lmer()</code> from the <code>lme4</code> package.</p>
<p>To get started, load the <code>lme4</code> package, which actually fits the models, and the <code>multilevelTools</code> package. Although not required, we load the <code>lmerTest</code> package to get approximate degrees of freedom for use in calculating p-values for the fixed effects. Without <code>lmerTest</code> p-values are based on asymptotic normality. We’ll also load an example dataset from the <code>JWileymisc</code> package, <code>aces_daily</code>, using the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function. The <code>aces_daily</code> dataset is simulated data from a daily, ecological momentary assessment study of 191 participants who completed ratings of <strong>a</strong>ctivity, <strong>c</strong>oping, <strong>e</strong>motions, and <strong>s</strong>tress (aces) up to three times per day for twelve days. Only a subset of variables were simulated, but it is a nice example of messy, real-world type data for mixed effects / multilevel models.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">## load lme4, JWileymisc, and multilevelTools packages</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">## (i.e., "open the 'apps' ") </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lme4)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; Loading required package: Matrix</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lmerTest)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; </span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; Attaching package: 'lmerTest'</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; The following object is masked from 'package:lme4':</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt;     lmer</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt;     step</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(extraoperators)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(JWileymisc)</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(multilevelTools)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">## load some sample data for examples</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(aces_daily, <span class="dt">package =</span> <span class="st">"JWileymisc"</span>)</span></code></pre></div>
<div id="a-quick-view-of-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#a-quick-view-of-the-data" class="anchor"></a>A Quick View of the Data</h2>
<p>Let’s start with a quick view of the <strong>str</strong>ucture of the data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">## overall structure</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(aces_daily, <span class="dt">nchar.max =</span> <span class="dv">30</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; 'data.frame':    6599 obs. of  19 variables:</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;  $ UserID            : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  $ SurveyDay         : Date, format: "2017-02-24" "2017-02-24" ...</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;  $ SurveyInteger     : int  2 3 1 2 3 1 2 3 1 2 ...</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;  $ SurveyStartTimec11: num  1.93e-01 4.86e-| __truncated__ ...</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;  $ Female            : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;  $ Age               : num  21 21 21 21 21 21 21 21 21 21 ...</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;  $ BornAUS           : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;  $ SES_1             : num  5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  $ EDU               : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt;  $ SOLs              : num  NA 0 NA NA 6.92 ...</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt;  $ WASONs            : num  NA 0 NA NA 0 NA NA 1 NA NA ...</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt;  $ STRESS            : num  5 1 1 2 0 0 3 1 0 3 ...</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt;  $ SUPPORT           : num  NA 7.02 NA NA 6.15 ...</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt;  $ PosAff            : num  1.52 1.51 1.56 1.56 1.13 ...</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt;  $ NegAff            : num  1.67 1 NA 1.36 1 ...</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt;  $ COPEPrb           : num  NA 2.26 NA NA NA ...</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt;  $ COPEPrc           : num  NA 2.38 NA NA NA ...</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt;  $ COPEExp           : num  NA 2.41 NA NA 2.03 ...</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt;  $ COPEDis           : num  NA 2.18 NA NA NA ...</span></span></code></pre></div>
<p>For this example, we will just work with negative affect, <code>NegAff</code>, as the outcome variable and stress, <code>STRESS</code>, as our predictor. Because observations are repeated per person, we also need to use a variable that indicates which observations belong to which person, <code>UserID</code>. The code that follows shows how many unique people and observations we have for each variable.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">## how many unique IDs (people) are there?</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(aces_daily<span class="op">$</span>UserID))</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; [1] 191</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">## how many not missing observations of negative affect are there?</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(aces_daily<span class="op">$</span>NegAff))</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; [1] 6389</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">## how many not missing observations of stress are there?</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(aces_daily<span class="op">$</span>STRESS))</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; [1] 6402</span></span></code></pre></div>
<p>Finally, we might explore each variable briefly, before jumping into analyzing them and examining diagnostics and effects of our models. Using the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function on each variable gives us some basic descriptive statistics in the form of a five number summary (minimum, first quartile, median (second quartile), third quartile, and maximum) as well as the arithmetic mean. The NA’s tell us how many observations are missing negative affect. We can see that both variables are quite skewed as their minimum, first quartile and medians are all close together and far away from the maximum.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(aces_daily<span class="op">$</span>NegAff)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;   1.000   1.029   1.280   1.550   1.813   5.000     210</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(aces_daily<span class="op">$</span>STRESS)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;   0.000   0.000   1.000   2.328   4.000  10.000     197</span></span></code></pre></div>
<p>Because these are repeated measures data, another useful descriptive statistic is the intraclass correlation coefficient or ICC. The ICC is a measure of the proportion of variance that is between people versus the total variance (i.e., variance between people and variance within persons). <code>multilevelTools</code> provides a function, <code><a href="../reference/iccMixed.html">iccMixed()</a></code> to estimate ICCs based off of mixed effects / multilevel models. The following code does this for negative affect and stress, first naming all the arguments and then using shorter unnamed approach, that is identical results, but easier to type. The relevant output is the ICC for the row named <code>UserID</code>. An ICC of 1 indicates that 100% of all variance exists between people, which would mean that 0% of variance exists within person, indicating that people have identical scores every time they are assessed. Conversely an ICC of 0 would indicate that everyone’s average was identical and 100% of the variance exists within person. For negative affect and stress, we can see the ICCs fall between 0 and 1, indicating that some variance is between people (i.e., individuals have different average levels of negative affect and stress) but also that some variance is within person, meaning that people’s negative affect and stress fluctuate or vary within a person across the day and the 12-days of the study.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw"><a href="../reference/iccMixed.html">iccMixed</a></span>(</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">dv =</span> <span class="st">"NegAff"</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">id =</span> <span class="st">"UserID"</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dt">data =</span> aces_daily)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;         Var     Sigma       ICC</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; 1:   UserID 0.2100950 0.4374139</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; 2: Residual 0.2702166 0.5625861</span></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw"><a href="../reference/iccMixed.html">iccMixed</a></span>(<span class="st">"STRESS"</span>, <span class="st">"UserID"</span>, aces_daily)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt;         Var   Sigma       ICC</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; 1:   UserID 2.04045 0.3228825</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; 2: Residual 4.27903 0.6771175</span></span></code></pre></div>
<p>Finally, we might want to examine the distribution of the variables visually. Visual exploration is a great way to identify the distribution of variables, extreme values, and other potential issues that can be difficult to identify numerically, such as bimodal distributions. For multilevel data, it is helpful to examine between and within person aspects of a variable separately. <code>multilevelTools</code> makes this easy using the <code><a href="../reference/meanDecompose.html">meanDecompose()</a></code> function. This is important as, for example, if on 11 of 12 days, someone has a negative affect score of 5, and then one day a score of 1, the score of 1 may be an extreme value, for that person even though it is common for the rest of the participants in the study. <code><a href="../reference/meanDecompose.html">meanDecompose()</a></code> returns a list with <code>X</code> values at different levels, here by ID and the residuals, which in this case are within person effects.</p>
<p>We make plots of the distributions using <code>testDistribution()</code>, which defaults to testing against a normal distribution, which is a common default and in our case appropriate for linear mixed effects / multilevel models. The graphs show a density plot in black lines, a normal distribution in dashed blue lines, a rug plot showing where individual observations fall, and the x-axis is a five number summary (minimum, first quartile, median, third quartile, maximum). The bottom plot is a Quantile-Quantile plot rotated to be horizontal instead of diagonal. Black dots / lines indicate extreme values, based on the expected theoretical distribution, here normal (gaussian), and specified percentile, <code>.001</code>. For more details, see <code><a href="https://rdrr.io/r/utils/help.html">help("testDistribution")</a></code>.</p>
<p>The between person results for negative affect show about five people with relative extreme higher scores. Considering negative affect ranges from 1 to 5, they are not impossible scores, but they are extreme relative to the rest of this particular sample. At the within person level, there are thousands of observations and there are many extreme scores. Based on these results, we may suspect that when we get into our mixed effects / multilevel model, there will be more extreme residual scores to be dealt with (which roughly correspond to within person results) than extreme random effects (which roughly correspond to between person results).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a></span>
<span id="cb6-2"><a href="#cb6-2"></a>tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meanDecompose.html">meanDecompose</a></span>(NegAff <span class="op">~</span><span class="st"> </span>UserID, <span class="dt">data =</span> aces_daily)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(tmp, <span class="dt">nchar.max =</span> <span class="dv">30</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;  $ NegAff by UserID  :Classes 'data.table' and 'data.frame': 191 obs. of  2 variables:</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;   ..$ UserID: int [1:191] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;   ..$ X     : num [1:191] 1.75 1.12 1.68 1.79 1.1 ...</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;  $ NegAff by residual:Classes 'data.table' and 'data.frame': 6599 obs. of  1 variable:</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;   ..$ X: num [1:6599] -0.0787 -0.7478| __truncated__ ...</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">testDistribution</span>(tmp[[<span class="st">"NegAff by UserID"</span>]]<span class="op">$</span>X,</span>
<span id="cb6-14"><a href="#cb6-14"></a>                      <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>, <span class="dt">ev.perc =</span> <span class="fl">.001</span>),</span>
<span id="cb6-15"><a href="#cb6-15"></a>     <span class="dt">varlab =</span> <span class="st">"Between Person Negative Affect"</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">testDistribution</span>(tmp[[<span class="st">"NegAff by residual"</span>]]<span class="op">$</span>X,</span>
<span id="cb7-3"><a href="#cb7-3"></a>                      <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>, <span class="dt">ev.perc =</span> <span class="fl">.001</span>),</span>
<span id="cb7-4"><a href="#cb7-4"></a>     <span class="dt">varlab =</span> <span class="st">"Within Person Negative Affect"</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>The same exercise for stress shows a better between and within person distribution. Certainly there is some skew and its not a perfect normal distribution. However, neither of these are required for predictors in mixed effects models. The extreme values are not that extreme or that far away from the rest of the sample, so we might feel comfortable proceeding with the data as is.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a></span>
<span id="cb8-2"><a href="#cb8-2"></a>tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meanDecompose.html">meanDecompose</a></span>(STRESS <span class="op">~</span><span class="st"> </span>UserID, <span class="dt">data =</span> aces_daily)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">testDistribution</span>(tmp[[<span class="st">"STRESS by UserID"</span>]]<span class="op">$</span>X,</span>
<span id="cb8-5"><a href="#cb8-5"></a>                      <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>, <span class="dt">ev.perc =</span> <span class="fl">.001</span>),</span>
<span id="cb8-6"><a href="#cb8-6"></a>     <span class="dt">varlab =</span> <span class="st">"Between Person STRESS"</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">testDistribution</span>(tmp[[<span class="st">"STRESS by residual"</span>]]<span class="op">$</span>X,</span>
<span id="cb9-3"><a href="#cb9-3"></a>                      <span class="dt">extremevalues =</span> <span class="st">"theoretical"</span>, <span class="dt">ev.perc =</span> <span class="fl">.001</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>     <span class="dt">varlab =</span> <span class="st">"Within Person STRESS"</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
</div>
<div id="mixed-effects-multilevel-model" class="section level1">
<h1 class="hasAnchor">
<a href="#mixed-effects-multilevel-model" class="anchor"></a>Mixed Effects (Multilevel) Model</h1>
<p>With a rough sense of our variables, we proceed to fitting a mixed effects model using the <code>lmer()</code> function from <code>lme4</code>. Here we use negative affect as the outcome predicted by stress. Both the intercept and linear slope of stress on negative affect are included as fixed and random effects. The random effects are allowed to be correlated, so that, for example, people who have higher negative affect under low stress may also have a flatter slope as thye may have less room to increase in negative affect at higher stress levels.</p>
<p>At the time of writing, this model using the default optimizer and control criteria fails to converge (albeit the gradient is very close). These convergence warnings can be spurious but also may suggest either a too complex model or need to refine some other aspect of the model, such as scaling predictors or changing the optimizer or arguments to the optimizer.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a>m &lt;-<span class="st"> </span><span class="kw">lmer</span>(NegAff <span class="op">~</span><span class="st"> </span>STRESS <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>STRESS <span class="op">|</span><span class="st"> </span>UserID),</span>
<span id="cb10-3"><a href="#cb10-3"></a>          <span class="dt">data =</span> aces_daily)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; Model failed to converge with max|grad| = 0.00201381 (tol = 0.002, component 1)</span></span></code></pre></div>
<p>Here we use the <code>lmerControl()</code> function to specify a different optimization algorithm using the Nelder-Mead Method (<a href="https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method" class="uri">https://en.wikipedia.org/wiki/Nelder%E2%80%93Mead_method</a>). We also tighten the tolerance values. This is then passed to <code>lmer()</code> by setting the argument, <code>control = strictControl</code>. This converges without warning.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a></span>
<span id="cb11-2"><a href="#cb11-2"></a>strictControl &lt;-<span class="st"> </span><span class="kw">lmerControl</span>(<span class="dt">optCtrl =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>   <span class="dt">algorithm =</span> <span class="st">"NLOPT_LN_NELDERMEAD"</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>   <span class="dt">xtol_abs =</span> <span class="fl">1e-12</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>   <span class="dt">ftol_abs =</span> <span class="fl">1e-12</span>))</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>m &lt;-<span class="st"> </span><span class="kw">lmer</span>(NegAff <span class="op">~</span><span class="st"> </span>STRESS <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>STRESS <span class="op">|</span><span class="st"> </span>UserID),</span>
<span id="cb11-8"><a href="#cb11-8"></a>          <span class="dt">data =</span> aces_daily, <span class="dt">control =</span> strictControl)</span></code></pre></div>
<p>Now we move on to examine model diagnostics. For linear mixed effects / multilevel models, the residuals should follow a normal distribution, the random effects should follow a multivariate normal distribution, and the residual variance should be homogenous (the same) as a single residual variance is estimated and used for the whole model. The <code>modelDiagnostics()</code> function in <code>multilevelTools</code> helps to evaluate these assumptions graphically.</p>
<p>The first plot shows (top left) the distribution of residuals. It is somewhat too narrow for a normal distribution (i.e., leptokurtic) and consequently many of the residuals on both tails are considered extreme values. However, the distribution is fairly symmetrical and for the residuals we have over 6,000 observations which will tend to make results relatively robust to violations.</p>
<p>The second plot (top right) shows the fitted (predicted) values for each observation against the residuals. The colour of the blocks indicates how many observations fall at a particular point. The solid blue line is a loess smooth line. Hopefully this line is about flat and stays consistently at residuals of 0 regardless of the predicted value, indicating no systematic bias. Finally the dashed blue lines indicate the 10th and 90th percentile (estimated from a quantile regression model) of the residuals across predicted values. If the residual variance is homogenous across the spread of predicted values, we would expect these dashed lines to be flat and parallel to each other. That is approximately true for all predicted values above about 1.7. For low predicted values, the residuals are 0 or higher and the spread of the dashed lines is narrowed. This is because people cannot have negative affect scores below 1 and many people reported negative affect around 1. Therefore for predicted negative affect scores of 1, the residuals tend to be about 0. This pattern is not ideal, but also not indicative of a terrible violation of the assumption. Two possible approaches to relaxing the assumption given data like these would be to use a censored model, that assumes true negative affect scores may be lower but are censored at 1 due to limitations in the measurement. Another would be to use a location and scale mixed effects model that models not only the mean (location) but also the scale (variance) as a function of some variables, which would allow the residual variance to differ. These are beyond the scope of this document, however.</p>
<p>The last three plots show the univariate distribution of the intercept and stress slope by <code>UserID</code>, the random intercept and slope and a test of whether the random intercept and slope are multivariate normal The multivariate normality test, based on the mahalonbis distances, suggests that there are a few, relatively extreme people. We might consider dropping these individuals from the analysis to examine whether results are sensitive to these extreme cases.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a></span>
<span id="cb12-2"><a href="#cb12-2"></a>md &lt;-<span class="st"> </span><span class="kw">modelDiagnostics</span>(m, <span class="dt">ev.perc =</span> <span class="fl">.001</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(md, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>In order to drop people who were extreme on the multivariate normality test, we can access a data table of the extreme values from the <code>modelDiagnostics</code> object. We subset it to only include the multivariate effects and use the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> function to show the first few rows. The extreme value table shows the scores on the outcome, the <code>UserID</code>, the index (which row) in the dataset, and the effect type, here all multivariate since we subset for that. We can use the <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> function to identify the IDs, which shows it is three IDs.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a></span>
<span id="cb13-2"><a href="#cb13-2"></a>mvextreme &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(md<span class="op">$</span>extremeValues,</span>
<span id="cb13-3"><a href="#cb13-3"></a>  EffectType <span class="op">==</span><span class="st"> "Multivariate Random Effect UserID"</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(mvextreme)</span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt;      NegAff UserID Index                        EffectType</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt; 1: 3.861232     56  1929 Multivariate Random Effect UserID</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt; 2: 2.362821     56  1930 Multivariate Random Effect UserID</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; 3: 3.145248     56  1931 Multivariate Random Effect UserID</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt; 4: 2.574245     56  1932 Multivariate Random Effect UserID</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; 5: 1.955497     56  1933 Multivariate Random Effect UserID</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt; 6: 1.848545     56  1934 Multivariate Random Effect UserID</span></span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mvextreme<span class="op">$</span>UserID)</span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt; [1]  56 111 185</span></span></code></pre></div>
<p>We can update the existing model using the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function and in the data, just subset to exclude those three extreme IDs. We re-run the diagnostics and plot again revealing one new multivariate extreme value.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a></span>
<span id="cb14-2"><a href="#cb14-2"></a>m2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(m, <span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(aces_daily,</span>
<span id="cb14-3"><a href="#cb14-3"></a>  UserID <span class="op">%!in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mvextreme<span class="op">$</span>UserID)))</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a>md2 &lt;-<span class="st"> </span><span class="kw">modelDiagnostics</span>(m2, <span class="dt">ev.perc =</span> <span class="fl">.001</span>)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(md2, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a></span>
<span id="cb15-2"><a href="#cb15-2"></a>mvextreme2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(md2<span class="op">$</span>extremeValues,</span>
<span id="cb15-3"><a href="#cb15-3"></a>  EffectType <span class="op">==</span><span class="st"> "Multivariate Random Effect UserID"</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mvextreme2<span class="op">$</span>UserID)</span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; [1] 123</span></span></code></pre></div>
<p>Again removing this further extreme ID and plotting diagnostics suggests that now the random effects are fairly “clean”.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a></span>
<span id="cb16-2"><a href="#cb16-2"></a>m3 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(m, <span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(aces_daily,</span>
<span id="cb16-3"><a href="#cb16-3"></a>  UserID <span class="op">%!in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mvextreme<span class="op">$</span>UserID), <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(mvextreme2<span class="op">$</span>UserID))))</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>md3 &lt;-<span class="st"> </span><span class="kw">modelDiagnostics</span>(m3, <span class="dt">ev.perc =</span> <span class="fl">.001</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(md3, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="lmer-vignette_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Now that we have a model whose diagnostics we are reasonably happy with, we can examine the results. The <code>modelPerformance()</code> function from the <code>multilevelTools</code> package gives some fit indices for the overall model, including measures of the variance accounted for by the fixed effects (marginal R2) and from the fixed and random effects combined (conditional R2). We also get information criterion (AIC, BIC), although note that with a REML estimator, the log likelihood and thus information criterion are not comparable to if the ML estimator was used.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">modelPerformance</span>(m3)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt; $Performance</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt;     Model Estimator N_Obs     N_Groups      AIC      BIC        LL LLDF</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; 1: merMod      REML  6262 UserID (187) 7173.374 7213.827 -3580.687    6</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">#&gt;        Sigma MarginalR2 ConditionalR2 MarginalF2 ConditionalF2</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt; 1: 0.4070051  0.2428319     0.5173111  0.3207107      1.071728</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">#&gt; </span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">#&gt; attr(,"class")</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">#&gt; [1] "modelPerformance.merMod" "modelPerformance"</span></span></code></pre></div>
<p>To see the results of individual variables, we can use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function to get the default model summary. Note that this summary differs slightly from that produced by <code>lme4</code> as it is overridden by <code>lmerTest</code> which adds degrees of freedom and p-values.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(m3)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">#&gt; Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; lmerModLmerTest]</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; Formula: NegAff ~ STRESS + (1 + STRESS | UserID)</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt;    Data: </span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt; subset(aces_daily, UserID %!in% c(unique(mvextreme$UserID), unique(mvextreme2$UserID)))</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; Control: strictControl</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; </span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt; REML criterion at convergence: 7161.4</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">#&gt; </span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">#&gt; Scaled residuals: </span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="co">#&gt; -5.1248 -0.5156 -0.1578  0.4040  6.4032 </span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">#&gt; </span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr</span></span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="co">#&gt;  UserID   (Intercept) 0.027953 0.16719      </span></span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="co">#&gt;           STRESS      0.003925 0.06265  0.43</span></span>
<span id="cb18-20"><a href="#cb18-20"></a><span class="co">#&gt;  Residual             0.165653 0.40701      </span></span>
<span id="cb18-21"><a href="#cb18-21"></a><span class="co">#&gt; Number of obs: 6262, groups:  UserID, 187</span></span>
<span id="cb18-22"><a href="#cb18-22"></a><span class="co">#&gt; </span></span>
<span id="cb18-23"><a href="#cb18-23"></a><span class="co">#&gt; Fixed effects:</span></span>
<span id="cb18-24"><a href="#cb18-24"></a><span class="co">#&gt;              Estimate Std. Error        df t value Pr(&gt;|t|)    </span></span>
<span id="cb18-25"><a href="#cb18-25"></a><span class="co">#&gt; (Intercept) 1.217e+00  1.456e-02 1.622e+02   83.64   &lt;2e-16 ***</span></span>
<span id="cb18-26"><a href="#cb18-26"></a><span class="co">#&gt; STRESS      1.152e-01  5.473e-03 1.854e+02   21.05   &lt;2e-16 ***</span></span>
<span id="cb18-27"><a href="#cb18-27"></a><span class="co">#&gt; ---</span></span>
<span id="cb18-28"><a href="#cb18-28"></a><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb18-29"><a href="#cb18-29"></a><span class="co">#&gt; </span></span>
<span id="cb18-30"><a href="#cb18-30"></a><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span id="cb18-31"><a href="#cb18-31"></a><span class="co">#&gt;        (Intr)</span></span>
<span id="cb18-32"><a href="#cb18-32"></a><span class="co">#&gt; STRESS 0.103</span></span></code></pre></div>
<p>This default summary gives quite a bit of key information. However, it does not provide some of the results that often are desired for scientific publication. Confidence intervals are commonly reported and t values often are not reported in preference for p-values. In addition, it is increasingly common to ask for effect sizes. The <code>modelTest()</code> function in <code>multilevelTools</code> provides further tests, including tests of the combined fixed + random effect for each variable and effect sizes based off the independent change in marginal and conditional R2, used to calculate a sort of cohen’s F2. All of the results are available in a series of tables for any programattic use. However, for individual use or reporting, caling <code>APAStyler()</code> will produce a nicely formatted output for humans. Confidence intervals are added in brackets and the effect sizes at the bottom are listed for stress considering fixed + random effects together.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a></span>
<span id="cb19-2"><a href="#cb19-2"></a>mt3 &lt;-<span class="st"> </span><span class="kw">modelTest</span>(m3)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">#&gt; Parameters and CIs are based on REML, </span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt; but modelTests requires ML not REML fit for comparisons, </span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt; and these are used in effect sizes. Refitting.</span></span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(mt3) <span class="co">## list of all tables available</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt; [1] "FixedEffects"  "RandomEffects" "EffectSizes"   "OverallModel"</span></span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="kw">APAStyler</span>(mt3)</span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">#&gt;                              Term                  Est           Type</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co">#&gt;  1:                   (Intercept) 1.22*** [1.19, 1.25]  Fixed Effects</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co">#&gt;  2:                        STRESS 0.12*** [0.10, 0.13]  Fixed Effects</span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co">#&gt;  3: cor_STRESS.(Intercept)|UserID                 0.43 Random Effects</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co">#&gt;  4:         sd_(Intercept)|UserID                 0.17 Random Effects</span></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co">#&gt;  5:              sd_STRESS|UserID                 0.06 Random Effects</span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co">#&gt;  6:                         sigma                 0.41 Random Effects</span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="co">#&gt;  7:                      Model DF                    6  Overall Model</span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co">#&gt;  8:                    N (Groups)         UserID (187)  Overall Model</span></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="co">#&gt;  9:              N (Observations)                 6262  Overall Model</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co">#&gt; 10:                        logLik             -3573.08  Overall Model</span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="co">#&gt; 11:                           AIC              7158.16  Overall Model</span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="co">#&gt; 12:                           BIC              7198.61  Overall Model</span></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="co">#&gt; 13:                   Marginal R2                 0.24  Overall Model</span></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="co">#&gt; 14:                   Marginal F2                 0.32  Overall Model</span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="co">#&gt; 15:                Conditional R2                 0.52  Overall Model</span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="co">#&gt; 16:                Conditional F2                 1.07  Overall Model</span></span>
<span id="cb19-28"><a href="#cb19-28"></a><span class="co">#&gt; 17:       STRESS (Fixed + Random)  0.32/0.24, p &lt; .001   Effect Sizes</span></span>
<span id="cb19-29"><a href="#cb19-29"></a><span class="co">#&gt; 18:               STRESS (Random) -0.07/0.01, p &lt; .001   Effect Sizes</span></span></code></pre></div>
<p>The output of <code>APAStyler()</code> can easily be copied and pasted into Excel or Word for formatting and publication. If the format is not as desired, some changes are fairly easy to make automatically. For example the following code uses 3 decimal points, lists exact p-values, and uses a semi colon instead of a comma for confidence intervals.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="kw">APAStyler</span>(mt3,</span>
<span id="cb20-3"><a href="#cb20-3"></a>          <span class="dt">format =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb20-4"><a href="#cb20-4"></a>            <span class="dt">FixedEffects =</span> <span class="st">"%s, %s (%s; %s)"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>            <span class="dt">RandomEffects =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"%s"</span>, <span class="st">"%s (%s, %s)"</span>),</span>
<span id="cb20-6"><a href="#cb20-6"></a>            <span class="dt">EffectSizes =</span> <span class="st">"%s, %s; %s"</span>),</span>
<span id="cb20-7"><a href="#cb20-7"></a>          <span class="dt">digits =</span> <span class="dv">3</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>          <span class="dt">pcontrol =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">digits =</span> <span class="dv">3</span>, <span class="dt">stars =</span> <span class="ot">FALSE</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>                          <span class="dt">includeP =</span> <span class="ot">TRUE</span>, <span class="dt">includeSign =</span> <span class="ot">TRUE</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>                          <span class="dt">dropLeadingZero =</span> <span class="ot">TRUE</span>))</span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt;                              Term                            Est           Type</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt;  1:                   (Intercept) 1.217, p &lt; .001 (1.189; 1.246)  Fixed Effects</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">#&gt;  2:                        STRESS 0.115, p &lt; .001 (0.104; 0.126)  Fixed Effects</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">#&gt;  3: cor_STRESS.(Intercept)|UserID                          0.427 Random Effects</span></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="co">#&gt;  4:         sd_(Intercept)|UserID                          0.167 Random Effects</span></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt;  5:              sd_STRESS|UserID                          0.063 Random Effects</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">#&gt;  6:                         sigma                          0.407 Random Effects</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt;  7:                      Model DF                              6  Overall Model</span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="co">#&gt;  8:                    N (Groups)                   UserID (187)  Overall Model</span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="co">#&gt;  9:              N (Observations)                           6262  Overall Model</span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="co">#&gt; 10:                        logLik                      -3573.079  Overall Model</span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="co">#&gt; 11:                           AIC                       7158.158  Overall Model</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="co">#&gt; 12:                           BIC                       7198.611  Overall Model</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="co">#&gt; 13:                   Marginal R2                          0.243  Overall Model</span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="co">#&gt; 14:                   Marginal F2                          0.322  Overall Model</span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="co">#&gt; 15:                Conditional R2                          0.517  Overall Model</span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="co">#&gt; 16:                Conditional F2                          1.068  Overall Model</span></span>
<span id="cb20-28"><a href="#cb20-28"></a><span class="co">#&gt; 17:       STRESS (Fixed + Random)         0.322, 0.242; p &lt; .001   Effect Sizes</span></span>
<span id="cb20-29"><a href="#cb20-29"></a><span class="co">#&gt; 18:               STRESS (Random)        -0.069, 0.005; p &lt; .001   Effect Sizes</span></span></code></pre></div>
<p>Finally, <code>APAStyler()</code> can be used with multiple models to create a convenient comparison. For example, although we removed several extreme values, we might want to compare the results in the full data to the dataset with extreme values removed to evaluate whether critical coefficients or effect sizes changed and if so how much. Some quantities, like the log likelihood, AIC and BIC are not comparable as the sample size changed. However, effect size estimates like the model marginal and conditional R2 can be reasonably compared as can the fixed effect coefficients and the effect sizes for particular predictors.</p>
<p>To create the output, we pass a list of <code>modelTest</code> objects and we can add names so that they are more nicely named in the output. The results show that the intercept, the predicted negative affect when stress is zero is very slightly higher in the original than in the model with outliers removed. The fixed effect coefficient for stress is identical, but the confidence interval is very slightly wider after removing outliers. Variability in the random intercept, slope, and residual variance, sigma, are all slightly reduced. All in all, we could conclude that the overall pattern of results and any conclusions that might be drawn from them would not functionally change in the model with all cases included versus after removing the extreme values, in this case. This effectively serves as a “sensitivity analysis” evaluating how sensitive the results of the model are to the inclusion / exclusion of extreme values. In this case, not very sensitive, which may be encouraging. In cases where there are large differences in the results, careful thought may be needed around which model is more likely to be “true” and what the implications of the differences are for interpretting and utilizing the results.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">## run modelTest() on the original model, m</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>mt &lt;-<span class="st"> </span><span class="kw">modelTest</span>(m)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">#&gt; Parameters and CIs are based on REML, </span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co">#&gt; but modelTests requires ML not REML fit for comparisons, </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; and these are used in effect sizes. Refitting.</span></span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="kw">APAStyler</span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Original =</span> mt, <span class="st">`</span><span class="dt">Outliers Removed</span><span class="st">`</span> =<span class="st"> </span>mt3))</span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#&gt;                              Term             Original     Outliers Removed</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#&gt;  1:                   (Intercept) 1.24*** [1.20, 1.27] 1.22*** [1.19, 1.25]</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt;  2:                        STRESS 0.12*** [0.11, 0.13] 0.12*** [0.10, 0.13]</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt;  3: cor_STRESS.(Intercept)|UserID                 0.47                 0.43</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#&gt;  4:         sd_(Intercept)|UserID                 0.21                 0.17</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">#&gt;  5:              sd_STRESS|UserID                 0.07                 0.06</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co">#&gt;  6:                         sigma                 0.42                 0.41</span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co">#&gt;  7:                      Model DF                    6                    6</span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">#&gt;  8:                    N (Groups)         UserID (191)         UserID (187)</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">#&gt;  9:              N (Observations)                 6389                 6262</span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co">#&gt; 10:                        logLik             -3845.41             -3573.08</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">#&gt; 11:                           AIC              7702.81              7158.16</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">#&gt; 12:                           BIC              7743.39              7198.61</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">#&gt; 13:                   Marginal R2                 0.23                 0.24</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">#&gt; 14:                   Marginal F2                 0.29                 0.32</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="co">#&gt; 15:                Conditional R2                 0.55                 0.52</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="co">#&gt; 16:                Conditional F2                 1.23                 1.07</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co">#&gt; 17:       STRESS (Fixed + Random)  0.29/0.26, p &lt; .001  0.32/0.24, p &lt; .001</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">#&gt; 18:               STRESS (Random) -0.06/0.02, p &lt; .001 -0.07/0.01, p &lt; .001</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="co">#&gt;               Type</span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co">#&gt;  1:  Fixed Effects</span></span>
<span id="cb21-29"><a href="#cb21-29"></a><span class="co">#&gt;  2:  Fixed Effects</span></span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">#&gt;  3: Random Effects</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co">#&gt;  4: Random Effects</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co">#&gt;  5: Random Effects</span></span>
<span id="cb21-33"><a href="#cb21-33"></a><span class="co">#&gt;  6: Random Effects</span></span>
<span id="cb21-34"><a href="#cb21-34"></a><span class="co">#&gt;  7:  Overall Model</span></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="co">#&gt;  8:  Overall Model</span></span>
<span id="cb21-36"><a href="#cb21-36"></a><span class="co">#&gt;  9:  Overall Model</span></span>
<span id="cb21-37"><a href="#cb21-37"></a><span class="co">#&gt; 10:  Overall Model</span></span>
<span id="cb21-38"><a href="#cb21-38"></a><span class="co">#&gt; 11:  Overall Model</span></span>
<span id="cb21-39"><a href="#cb21-39"></a><span class="co">#&gt; 12:  Overall Model</span></span>
<span id="cb21-40"><a href="#cb21-40"></a><span class="co">#&gt; 13:  Overall Model</span></span>
<span id="cb21-41"><a href="#cb21-41"></a><span class="co">#&gt; 14:  Overall Model</span></span>
<span id="cb21-42"><a href="#cb21-42"></a><span class="co">#&gt; 15:  Overall Model</span></span>
<span id="cb21-43"><a href="#cb21-43"></a><span class="co">#&gt; 16:  Overall Model</span></span>
<span id="cb21-44"><a href="#cb21-44"></a><span class="co">#&gt; 17:   Effect Sizes</span></span>
<span id="cb21-45"><a href="#cb21-45"></a><span class="co">#&gt; 18:   Effect Sizes</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-quick-view-of-the-data">A Quick View of the Data</a></li>
      <li><a href="#mixed-effects-multilevel-model">Mixed Effects (Multilevel) Model</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
